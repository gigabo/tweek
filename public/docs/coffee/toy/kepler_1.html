<!DOCTYPE html>  <html> <head>   <title>kepler_1.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="/css/docco.css" />   <script type="text/javascript"     src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js">   </script>   <script type="text/javascript" src="/js/link_deps.js"></script>   <script type="text/javascript" src="/js/ga.js"></script> </head> <body>   <div id="container">            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="hanoi.html">                 hanoi.coffee               </a>                                           <a class="source" href="kepler_1.html">                 kepler_1.coffee               </a>                                           <a class="source" href="pasta.html">                 pasta.coffee               </a>                                           <a class="source" href="punch.html">                 punch.coffee               </a>                                           <a class="source" href="rocket.html">                 rocket.coffee               </a>                                           <a class="source" href="rocket_box2d.html">                 rocket_box2d.coffee               </a>                                           <a class="source" href="unit_circle.html">                 unit_circle.coffee               </a>                        </div>         </div>       </div>          <div id="background"></div>     <div id="link_home"><a href="/">Home</a></div>     <div id="link_deps"></div>     <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               kepler_1.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nx">require</span><span class="p">.</span><span class="nx">def</span> <span class="p">[</span>
  <span class="s1">&#39;toy2d/debug&#39;</span><span class="p">,</span>
  <span class="s1">&#39;toy2d/canvas&#39;</span><span class="p">,</span>
  <span class="s1">&#39;toy2d/canvas_scale&#39;</span><span class="p">,</span>
  <span class="s1">&#39;/js/mustache.js&#39;</span><span class="p">,</span>
<span class="p">],</span>
<span class="p">(</span><span class="nx">Debug</span><span class="p">,</span> <span class="nx">Canvas</span><span class="p">,</span> <span class="nx">CanvasScale</span><span class="p">)</span> <span class="o">=&gt;</span>

  <span class="nv">PI = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span>

  <span class="k">class</span> <span class="nx">Toy</span>
    <span class="nv">constructor: </span><span class="nf">() -&gt;</span>
      <span class="vi">@canvas = </span><span class="k">new</span> <span class="nx">Canvas</span>
      <span class="k">new</span> <span class="nx">CanvasScale</span><span class="p">(</span><span class="nx">@canvas</span><span class="p">.</span><span class="nx">jquery</span><span class="p">(),.</span><span class="mi">8</span><span class="p">)</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">init_centered</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>
      <span class="vi">@width  = </span><span class="nx">@canvas</span><span class="p">.</span><span class="nx">draw_width</span>
      <span class="vi">@height = </span><span class="nx">@canvas</span><span class="p">.</span><span class="nx">draw_height</span>
      <span class="vi">@degree = </span><span class="mi">0</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">init_formulae</span><span class="p">()</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">init_controls</span><span class="p">()</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>

    <span class="nv">init_formulae: </span><span class="nf">() -&gt;</span>
      <span class="vi">@formulae = </span><span class="p">[</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>This is what I found when I read the wikipedia article on ellipses
more carefully :)</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">{</span>
          <span class="nv">name: </span><span class="s1">&#39;sqrt(a^2-b^2)&#39;</span><span class="p">,</span>
          <span class="nv">func: </span><span class="nf">(a, b) -&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">((</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="nx">b</span><span class="o">*</span><span class="nx">b</span><span class="p">))</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>This is what I came up with given the formula for the eccentricity
of an ellipse: sqrt(1-(b/a)^2)</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">{</span>
          <span class="nv">name: </span><span class="s1">&#39;a * sqrt(1-(b^2/a^2))&#39;</span><span class="p">,</span>
          <span class="nv">func: </span><span class="nf">(a, b) -&gt;</span> <span class="nx">a</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">((</span><span class="nx">b</span><span class="o">*</span><span class="nx">b</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="p">)))</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nv">name: </span><span class="s1">&#39;a&#39;</span><span class="p">,</span>
          <span class="nv">func: </span><span class="nf">(a, b) -&gt;</span> <span class="nx">a</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nv">name: </span><span class="s1">&#39;a - b&#39;</span><span class="p">,</span>
          <span class="nv">func: </span><span class="nf">(a, b) -&gt;</span> <span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nv">name: </span><span class="s1">&#39;a^2 - b^2&#39;</span><span class="p">,</span>
          <span class="nv">func: </span><span class="nf">(a, b) -&gt;</span> <span class="nx">a</span><span class="o">*</span><span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span><span class="o">*</span><span class="nx">b</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nv">name: </span><span class="s1">&#39;a * cos(b/a)&#39;</span><span class="p">,</span>
          <span class="nv">func: </span><span class="nf">(a, b) -&gt;</span> <span class="nx">a</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">b</span><span class="o">/</span><span class="nx">a</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nv">name: </span><span class="s1">&#39;a * 2^(a-b) - a&#39;</span><span class="p">,</span>
          <span class="nv">func: </span><span class="nf">(a, b) -&gt;</span> <span class="nx">a</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="nx">a</span><span class="o">-</span><span class="nx">b</span><span class="p">))</span><span class="o">-</span><span class="nx">a</span>
        <span class="p">},</span>
      <span class="p">]</span>
      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">@formulae</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nx">@formulae</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">index</span><span class="o">=</span><span class="nx">i</span>

    <span class="nv">init_controls: </span><span class="nf">() -&gt;</span>
      <span class="vi">@current_formula = </span><span class="mi">0</span>
      <span class="vi">@current_steps   = </span><span class="mi">10</span>
      <span class="vi">@steps_values = </span><span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="mi">20</span><span class="p">]</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#controls&quot;</span><span class="p">).</span><span class="nx">append</span> <span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span> <span class="sh">&#39;&#39;&#39;</span>
<span class="sh">        &lt;select id=&quot;steps_selector&quot;&gt;</span>
<span class="sh">          {{#steps_values}}</span>
<span class="sh">          &lt;option value=&quot;{{.}}&quot;&gt;Approximation steps: {{.}}&lt;/option&gt;</span>
<span class="sh">          {{/steps_values}}</span>
<span class="sh">        &lt;/select&gt;</span>
<span class="sh">        &lt;select id=&quot;formula_selector&quot;&gt;</span>
<span class="sh">          {{#formulae}}</span>
<span class="sh">          &lt;option value=&quot;{{index}}&quot;&gt;Formula: {{name}}&lt;/option&gt;</span>
<span class="sh">          {{/formulae}}</span>
<span class="sh">        &lt;/select&gt;</span>
<span class="sh">      &#39;&#39;&#39;</span><span class="p">,</span> <span class="k">this</span>
      <span class="nv">f_control= </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#formula_selector&quot;</span><span class="p">)</span>
      <span class="nx">f_control</span><span class="p">.</span><span class="nx">change</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="vi">@current_formula = </span><span class="nx">f_control</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>
      <span class="nv">s_control= </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#steps_selector&quot;</span><span class="p">)</span>
      <span class="nx">s_control</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
      <span class="nx">s_control</span><span class="p">.</span><span class="nx">change</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="vi">@current_steps = </span><span class="nx">s_control</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>

    <span class="nv">start: </span><span class="nf">() -&gt;</span> <span class="nx">setInterval</span><span class="p">(</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">step</span><span class="p">()),</span> <span class="mi">33</span><span class="p">)</span>

    <span class="nv">step: </span><span class="nf">() -&gt;</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">clear</span><span class="p">()</span>

      <span class="k">if</span> <span class="o">++</span><span class="nx">@degree</span> <span class="o">==</span> <span class="mi">360</span> <span class="k">then</span> <span class="vi">@degree = </span><span class="mi">0</span>

      <span class="nv">thick = </span><span class="p">.</span><span class="mi">025</span>
      <span class="nv">thin  = </span><span class="p">.</span><span class="mi">005</span>

      <span class="nv">theta = </span><span class="nx">@degree</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">PI</span> <span class="o">/</span> <span class="mi">360</span>
      <span class="nv">x = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
      <span class="nv">y = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>

      <span class="vi">@canvas.ctx.lineWidth = </span><span class="nx">thin</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Axes</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">set_color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">draw_at</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">@canvas</span><span class="p">.</span><span class="nx">line</span><span class="p">(</span><span class="o">-</span><span class="nx">@width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">@width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">draw_at</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">@canvas</span><span class="p">.</span><span class="nx">line</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="nx">@height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">@height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

      <span class="vi">@canvas.ctx.lineWidth = </span><span class="nx">thick</span>

      <span class="nv">a = </span><span class="mf">1.5</span><span class="o">+</span><span class="nx">x</span><span class="o">/</span><span class="mi">2</span>
      <span class="nv">b = </span><span class="mi">1</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">draw_at</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">@canvas</span><span class="p">.</span><span class="nx">ellipse</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Ellipse Axes</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">set_color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,.</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">draw_at</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">@canvas</span><span class="p">.</span><span class="nx">line</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="o">-</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">label</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="nx">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">draw_at</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">@canvas</span><span class="p">.</span><span class="nx">line</span><span class="p">(</span><span class="o">-</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span><span class="nx">b</span><span class="p">)</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">label</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="nx">b</span><span class="o">/</span><span class="mi">2</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>First, draw an approximation of focus position.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">fx = </span><span class="k">this</span><span class="p">.</span><span class="nx">approximate_focus</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">set_color</span><span class="p">(.</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">draw_at</span> <span class="nx">fx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">@canvas</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">thick</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nx">PI</span><span class="p">)</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">label</span> <span class="s2">&quot;Sun&quot;</span><span class="p">,</span> <span class="nx">fx</span><span class="p">,</span> <span class="mf">0.1</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">draw_at</span><span class="p">(</span><span class="o">-</span><span class="mf">2.4</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">@canvas</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">thick</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nx">PI</span><span class="p">))</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">label_left</span> <span class="s2">&quot;Binary Approximation (#{@current_steps})&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.3</span><span class="p">,</span> <span class="mf">1.1</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Then try to find a formula to match it.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">fx = </span><span class="nx">@formulae</span><span class="p">[</span><span class="nx">@current_formula</span><span class="p">].</span><span class="nx">func</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">)</span>

      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">set_color</span><span class="p">(</span><span class="mi">0</span><span class="p">,.</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">draw_at</span> <span class="nx">fx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">@canvas</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">thick</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nx">PI</span><span class="p">)</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">label</span> <span class="s2">&quot;Sun&quot;</span><span class="p">,</span> <span class="nx">fx</span><span class="p">,</span> <span class="mf">0.1</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">draw_at</span><span class="p">(</span><span class="o">-</span><span class="mf">2.4</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">@canvas</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">thick</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nx">PI</span><span class="p">))</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">label_left</span> <span class="s2">&quot;Formula: #{@formulae[@current_formula].name}&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.3</span><span class="p">,</span> <span class="mf">0.95</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>I didn't know how to derive the position of foci from the axis lengths
of my ellipse, so I decided to first approximate, and then see if I
could figure out a simple formula that would match the approximation and
eliminate the need for it.  This approximation uses the fact that the
sum of distances from all points on the ellipse to the foci are the
same.  This method assumes that the major axis lays along the X-axis.
It starts with a candidate focus halfway between the center of the
ellipse and the positive-X intersection with the major axis, and then
does a binary searh for 10 steps.  I initially made the number of steps
dynamic and then tried various values to find the lowest that gave a
smooth animation. :D</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">approximate_focus: </span><span class="nf">(a, b) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>x is our candidate focus position (on the x axis)
dx is how far we move the candidate focus each step</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">dx = x = </span><span class="nx">a</span> <span class="o">/</span> <span class="mi">2</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Sum of distances from foci to point on major axis.
This is always just 2 * semimajor axis length:
  Foci are P1:[x, 0] and P2:[-x, 0].
  Point on major axis is [a, 0]
  P1 distance is a-x
  P2 distance is a+x
  Sum of distances is a+x+a-x = a+a+x-x = 2*a</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">major = </span><span class="mi">2</span><span class="o">*</span><span class="nx">a</span>

      <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">@current_steps</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>The sum of distances from foci to point on minor axis.
Each focal distance is the hypotenuse of a right triangle
with legs on the X and Y axes, which lets us easily calculate
using the Pythagorean theorem.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">minor = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">b</span><span class="o">*</span><span class="nx">b</span><span class="o">+</span><span class="nx">x</span><span class="o">*</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>This is a binary search.  Each step we'll move half as far
as we did previously.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">dx</span> <span class="o">/=</span> <span class="mi">2</span>

        <span class="nx">x</span> <span class="o">+=</span> <span class="nx">dx</span> <span class="o">*</span> <span class="k">if</span> <span class="nx">minor</span> <span class="o">&lt;</span> <span class="nx">major</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>

      <span class="nx">x</span>

</pre></div>             </td>           </tr>                </tbody>     </table>     <div id="link_docco">       &copy; 2010 Bo Borgerson |       HTML Docs produced with <a href="http://jashkenas.github.com/docco/">Docco</a>     </div>   </div> </body> </html> 